glam={documents:{},documentIndex:0,styles:{},viewers:{},animations:{}},glam.isReady=!1,glam.ready=function(e){glam.isReady||(glam.parser.parseDocument(e),glam.createViewers(),glam.isReady=!0)},glam.createViewers=function(){for(docname in glam.documents){var e=glam.documents[docname],a=new glam.Viewer(e);glam.viewers[docname]=a,a.go()}},glam.addStyle=function(e,a){glam.styles[e]=a},glam.getStyle=function(e){return glam.styles[e]},glam.addAnimation=function(e,a){glam.animations[e]=a},glam.getAnimation=function(e){return glam.animations[e]},glam.setFullScreen=function(e){return Vizi.Graphics.instance.setFullScreen(e)},glam.Animation={},glam.Animation.DEFAULT_DURATION="1s",glam.Animation.DEFAULT_ITERATION_COUNT="1",glam.Animation.DEFAULT_TIMING_FUNCTION="linear",glam.Animation.DEFAULT_FRAME_TIME="0%",glam.Animation.DEFAULT_FRAME_PROPERTY="transform",glam.Animation.create=function(e){var a=e.id,t=e.getAttribute("duration")||glam.Animation.DEFAULT_DURATION,r=e.getAttribute("iteration-count")||glam.Animation.DEFAULT_ITERATION_COUNT,i=e.getAttribute("timing-function")||glam.Animation.DEFAULT_TIMING_FUNCTION;t=glam.Animation.parseTime(t);var n,l=glam.Animation.parseTimingFunction(i),s="infinite"==r.toLowerCase()?!0:!1,o=e.childNodes,m=o.length,g=[];for(n=0;m>n;n++){var c=o[n],u=c.tagName;if(u&&(u=u.toLowerCase()),"keyframe"==u){var p=glam.Animation.parseFrame(c);g.push(p)}}var d=glam.Animation.build(t,s,l,g);glam.addAnimation(a,d),glam.Animation.callParseCallbacks(a,d)},glam.Animation.parseFrame=function(e){var a=e.getAttribute("time")||glam.Animation.DEFAULT_FRAME_TIME,t=glam.Animation.parseFrameTime(a),r=e.getAttribute("property")||glam.Animation.DEFAULT_FRAME_PROPERTY,i=e.getAttribute("value")||"";if("transform"==r){var n={};return glam.Transform.parseTransform(i,n),{time:t,value:n,type:"transform"}}if("material"==r){var l=glam.Animation.parseMaterial(i),s=glam.Material.parseStyle(l);return{time:t,value:s,type:"material"}}},glam.Animation.createFromStyle=function(e,a,t){var r,i,n,l,s,o,m,g;if(i=a["animation-name"]||a["-webkit-animation-name"]||a["-moz-animation-name"])n=a["animation-duration"]||a["-webkit-animation-duration"]||a["-moz-animation-duration"],l=a["animation-timing-function"]||a["-webkit-animation-timing-function"]||a["-moz-animation-timing-function"],m=a["animation-iteration-count"]||a["-webkit-animation-iteration-count"]||a["-moz-animation-iteration-count"];else if(r=a.animation||a["-webkit-animation"]||a["-moz-animation"]){var c=r.split("\\s+");i=c[0],n=c[1],l=c[2],o=c[3],m=c[4]}if(n=n||glam.Animation.DEFAULT_DURATION,n=glam.Animation.parseTime(n),l=l||glam.Animation.DEFAULT_TIMING_FUNCTION,s=glam.Animation.parseTimingFunction(l),m=m||glam.Animation.DEFAULT_ITERATION_COUNT,g="infinite"==m.toLowerCase()?!0:!1,i){var u=glam.getStyle(i),p=[];for(var d in u){var f;f="from"==d?0:"to"==d?1:glam.Animation.parseFrameTime(d);var v,E=u[d];for(prop in E){var h,T=E[prop];"transform"==prop||"-webkit-transform"==prop||"-moz-transform"==prop?(h="transform",v={},glam.Transform.parseTransform(T,v)):("opacity"==prop||"color"==prop)&&(h="material",v=glam.Material.parseStyle(E));var A={time:f,value:v,type:h};p.push(A)}}var b=glam.Animation.build(n,g,s,p);glam.Animation.addAnimationToObject(b,t)}},glam.Animation.build=function(e,a,t,r){var i,n=[],l=[],s=[],o=[],m=[],g=[],c=[],u=[],p=[],d=[],f=r.length;for(i=0;f>i;i++){var v=r[i],E=v.value;if("transform"==v.type){if("x"in E||"y"in E||"z"in E){n.push(v.time);var h={};"x"in E&&(h.x=E.x),"y"in E&&(h.y=E.y),"z"in E&&(h.z=E.z),l.push(h)}if("rx"in E||"ry"in E||"rz"in E){s.push(v.time);var h={};"rx"in E&&(h.x=E.rx),"ry"in E&&(h.y=E.ry),"rz"in E&&(h.z=E.rz),o.push(h)}if("sx"in E||"sy"in E||"sz"in E){m.push(v.time);var h={};"sx"in E&&(h.x=E.sx),"sy"in E&&(h.y=E.sy),"sz"in E&&(h.z=E.sz),g.push(h)}}else if("material"==v.type&&("opacity"in E&&(c.push(v.time),u.push({opacity:parseFloat(E.opacity)})),"color"in E)){p.push(v.time);var T=new THREE.Color(E.color);d.push({r:T.r,g:T.g,b:T.b})}}var A={duration:e,loop:a,easing:t,poskeys:n,posvalues:l,rotkeys:s,rotvalues:o,sclkeys:m,sclvalues:g,opakeys:c,opavalues:u,colorkeys:p,colorvalues:d};return A},glam.Animation.parseTime=function(e){var a=e.indexOf("ms");if(-1!=a)return parseFloat(e.split("ms")[0]);var a=e.indexOf("s");return-1!=a?1e3*parseFloat(e.split("s")[0]):void 0},glam.Animation.parseFrameTime=function(e){var a=e.indexOf("%");return-1!=a?parseFloat(e.split("%")[0])/100:parseFloat(e)},glam.Animation.parseTimingFunction=function(e){switch(e=e.toLowerCase()){case"linear":return TWEEN.Easing.Linear.None;case"ease-in-out":default:return TWEEN.Easing.Quadratic.InOut}},glam.Animation.parseMaterial=function(e){var a,t={},r=e.split(";"),i=r.length;for(a=0;i>a;a++){var n=r[a];if(n){var l=n.split(":"),s=l[0],o=l[1];t[s]=o}}return t},glam.Animation.parse=function(e,a,t){var r=e.getAttribute("animation");if(r){var i=glam.getAnimation(r);i?glam.Animation.addAnimationToObject(i,t):glam.Animation.addParseCallback(r,function(e){glam.Animation.addAnimationToObject(e,t)})}else glam.Animation.createFromStyle(e,a,t)},glam.Animation.addAnimationToObject=function(e,a){var t=[];e.poskeys.length&&t.push({keys:e.poskeys,values:e.posvalues,target:a.transform.position}),e.rotkeys.length&&t.push({keys:e.rotkeys,values:e.rotvalues,target:a.transform.rotation}),e.sclkeys.length&&t.push({keys:e.sclkeys,values:e.sclvalues,target:a.transform.scale}),e.opakeys.length&&t.push({keys:e.opakeys,values:e.opavalues,target:a.visuals[0].material}),e.colorkeys.length&&t.push({keys:e.colorkeys,values:e.colorvalues,target:a.visuals[0].material.color});e.iterationCount>1;if(t.length){var r=new Vizi.KeyFrameAnimator({interps:t,duration:e.duration,loop:e.loop,easing:e.easing});a.addComponent(r),r.start()}},glam.Animation.parseCallbacks={},glam.Animation.addParseCallback=function(e,a){var t=glam.Animation.parseCallbacks[e];t||(t={callbacks:[]},glam.Animation.parseCallbacks[e]=t),t.callbacks.push(a)},glam.Animation.callParseCallbacks=function(e,a){var t=glam.Animation.parseCallbacks[e];if(t){var r,i=t.callbacks,n=i.length;for(r=0;n>r;r++){var l=i[r];l(a)}}},glam.Arc={},glam.Arc.DEFAULT_RADIUS=2,glam.Arc.DEFAULT_RADIUS_SEGMENTS=32,glam.Arc.DEFAULT_START_ANGLE="0deg",glam.Arc.DEFAULT_END_ANGLE="360deg",glam.Arc.create=function(e,a){return glam.Visual.create(e,a,glam.Arc)},glam.Arc.getAttributes=function(e,a,t){function r(e){return glam.Transform.parseRotation(e)}var i=e.getAttribute("radius")||glam.Arc.DEFAULT_RADIUS,n=e.getAttribute("radiusSegments")||glam.Arc.DEFAULT_RADIUS_SEGMENTS,l=e.getAttribute("startAngle")||glam.Arc.DEFAULT_START_ANGLE,s=e.getAttribute("endAngle")||glam.Arc.DEFAULT_END_ANGLE;a&&(a.radius&&(i=a.radius),a.radiusSegments&&(n=a.radiusSegments),a.startAngle&&(l=a.startAngle),a.endAngle&&(s=a.endAngle)),i=parseFloat(i),n=parseInt(n),l=r(l),s=r(s),t.radius=i,t.radiusSegments=n,t.startAngle=l,t.endAngle=s},glam.Arc.createVisual=function(e,a,t){var r=new Vizi.Visual({geometry:new THREE.CircleGeometry(t.radius,t.radiusSegments,t.startAngle,t.endAngle),material:a});return r},glam.Background={},glam.Background.DEFAULT_BACKGROUND_TYPE="box",glam.Background.create=function(e,a){var t=e.getAttribute("background-type")||glam.Background.DEFAULT_BACKGROUND_TYPE;if(t=e.getAttribute("type")||t,a){a["background-type"]&&(t=a["background-type"]);var r=glam.Material.parseStyle(a)}var i;if("box"==t){i=Vizi.Prefabs.Skybox();var n=i.getComponent(Vizi.SkyboxScript);n.texture=r.envMap}else"sphere"==t&&(i=Vizi.Prefabs.Skysphere(),skysphereScript=i.getComponent(Vizi.SkysphereScript),skysphereScript.texture=r.envMap);return glam.Background.addHandlers(e,a,i),Vizi.Application.instance.addObject(i),null},glam.Background.addHandlers=function(e,a,t){e.glam.setAttributeHandlers.push(function(a,r){glam.Background.onSetAttribute(t,e,a,r)}),a.setPropertyHandlers.push(function(a,r){glam.Background.onSetAttribute(t,e,a,r)})},glam.Background.onSetAttribute=function(e,a,t,r){switch(t){case"sphere-image":case"sphereImage":var i=e.getComponent(Vizi.SkysphereScript);if(i){var n=THREE.ImageUtils.loadTexture(r);i.texture=n}}},glam.Camera={},glam.Camera.DEFAULT_FOV=45,glam.Camera.DEFAULT_NEAR=1,glam.Camera.DEFAULT_FAR=1e4,glam.Camera.create=function(e,a,t){var r=e.getAttribute("fov")||glam.Camera.DEFAULT_FOV,i=e.getAttribute("near")||glam.Camera.DEFAULT_NEAR,n=e.getAttribute("far")||glam.Camera.DEFAULT_FAR,l=e.getAttribute("aspect");a&&(a.fov&&(r=a.fov),a.near&&(i=a.near),a.far&&(n=a.far),a.aspect&&(l=a.aspect)),r=parseFloat(r),i=parseFloat(i),n=parseFloat(n);var s={fov:r,near:i,far:n};l&&(l=parseFloat(l),s.aspect=l);var o=new Vizi.Object,m=new Vizi.PerspectiveCamera(s);return o.addComponent(m),t.addCamera(m,e.id),o},glam.Circle={},glam.Circle.DEFAULT_RADIUS=2,glam.Circle.DEFAULT_RADIUS_SEGMENTS=32,glam.Circle.create=function(e,a){return glam.Visual.create(e,a,glam.Circle)},glam.Circle.getAttributes=function(e,a,t){var r=e.getAttribute("radius")||glam.Circle.DEFAULT_RADIUS,i=e.getAttribute("radiusSegments")||glam.Circle.DEFAULT_RADIUS_SEGMENTS;a&&(a.radius&&(r=a.radius),a.radiusSegments&&(i=a.radiusSegments)),r=parseFloat(r),i=parseInt(i),t.radius=r,t.radiusSegments=i},glam.Circle.createVisual=function(e,a,t){var r=new Vizi.Visual({geometry:new THREE.CircleGeometry(t.radius,t.radiusSegments),material:a});return r},glam.ClassList=function(e){this.docelt=e,Array.call(this)},glam.ClassList.prototype=new Array,glam.ClassList.prototype.item=function(e){return this[e]},glam.ClassList.prototype.add=function(e){return this.push(e)},glam.ClassList.prototype.remove=function(e){var a=this.indexOf(e);-1!=a&&this.splice(a,1)},glam.Cone={},glam.Cone.DEFAULT_RADIUS=2,glam.Cone.DEFAULT_HEIGHT=2,glam.Cone.create=function(e,a){return glam.Visual.create(e,a,glam.Cone)},glam.Cone.getAttributes=function(e,a,t){var r=e.getAttribute("radius")||glam.Cone.DEFAULT_RADIUS,i=e.getAttribute("height")||glam.Cone.DEFAULT_HEIGHT;a&&(a.radius&&(r=a.radius),a.height&&(i=a.height)),r=parseFloat(r),i=parseFloat(i),t.radius=r,t.height=i},glam.Cone.createVisual=function(e,a,t){var r=new Vizi.Visual({geometry:new THREE.CylinderGeometry(0,t.radius,t.height,32),material:a});return r},glam.Controller={},glam.Controller.create=function(e,a,t){var r=!0,i=e.getAttribute("noheadlight");null!==i&&(r=!1,t.controllerScript.headlightOn=!1);var n=e.getAttribute("type");if(null!==n)if(n=n.toLowerCase(),"fps"==n){var l=(parseFloat(e.getAttribute("x"))||0,parseFloat(e.getAttribute("y"))||0,parseFloat(e.getAttribute("z"))||0,Vizi.Prefabs.FirstPersonController({active:!0,headlight:r})),s=l.getComponent(Vizi.FirstPersonControllerScript);t.addObject(l);var o=new Vizi.Object,m=new Vizi.PerspectiveCamera;o.addComponent(m),t.addObject(o),s.camera=m,m.active=!0}else if("rift"==n){var l=Vizi.Prefabs.RiftController({active:!0,headlight:r,mouseLook:!1,useVRJS:!0}),s=l.getComponent(Vizi.RiftControllerScript);t.addObject(l);var o=new Vizi.Object,m=new Vizi.PerspectiveCamera;o.addComponent(m),t.addObject(o),s.camera=m,m.active=!0,t.controllerScript&&(t.controllerScript.enabled=!1),t.controller=l,t.controllerScript=s}else if("deviceorientation"==n){var l=Vizi.Prefabs.DeviceOrientationController({active:!0,headlight:r,mouseLook:!1,useVRJS:!0}),s=l.getComponent(Vizi.DeviceOrientationControllerScript);t.addObject(l);var o=new Vizi.Object,m=new Vizi.PerspectiveCamera;o.addComponent(m),t.addObject(o),s.camera=m,m.active=!0,t.controllerScript&&(t.controllerScript.enabled=!1),t.controller=l,t.controllerScript=s}return null},glam.Cube={},glam.Cube.DEFAULT_WIDTH=2,glam.Cube.DEFAULT_HEIGHT=2,glam.Cube.DEFAULT_DEPTH=2,glam.Cube.create=function(e,a){return glam.Visual.create(e,a,glam.Cube)},glam.Cube.getAttributes=function(e,a,t){var r=e.getAttribute("width")||glam.Cube.DEFAULT_WIDTH,i=e.getAttribute("height")||glam.Cube.DEFAULT_HEIGHT,n=e.getAttribute("depth")||glam.Cube.DEFAULT_DEPTH;a&&(a.width&&(r=a.width),a.height&&(i=a.height),a.depth&&(n=a.depth)),r=parseFloat(r),i=parseFloat(i),n=parseFloat(n),t.width=r,t.height=i,t.depth=n},glam.Cube.createVisual=function(e,a,t){var r=new Vizi.Visual({geometry:new THREE.BoxGeometry(t.width,t.height,t.depth),material:a});return r},glam.Cylinder={},glam.Cylinder.DEFAULT_RADIUS=2,glam.Cylinder.DEFAULT_HEIGHT=2,glam.Cylinder.create=function(e,a){return glam.Visual.create(e,a,glam.Cylinder)},glam.Cylinder.getAttributes=function(e,a,t){var r=e.getAttribute("radius")||glam.Cylinder.DEFAULT_RADIUS,i=e.getAttribute("height")||glam.Cylinder.DEFAULT_HEIGHT;a&&(a.radius&&(r=a.radius),a.height&&(i=a.height)),r=parseFloat(r),i=parseFloat(i),t.radius=r,t.height=i},glam.Cylinder.createVisual=function(e,a,t){var r=new Vizi.Visual({geometry:new THREE.CylinderGeometry(t.radius,t.radius,t.height,32),material:a});return r},glam.document={scenes:{},styles:[],animations:{},addScene:function(e,a){glam.document.scenes[e.id]={parentElement:e.parentElement,scene:a}},addStyle:function(e){glam.document.styles.push(e)},addAnimation:function(e,a){glam.document.animations[e]=a},parseDocument:function(){var e,a,t=new DOMParser,r=document.getElementsByTagName("script"),a=r.length;for(e=0;a>e;e++)if("text/glam"==r[e].type){var i=t.parseFromString(r[e].textContent,"text/xml");glam.document.addScene(r[e],i)}var n=document.head.getElementsByTagName("style"),a=n.length;for(e=0;a>e;e++)$.parsecss(n[e].childNodes[0].data,function(e){glam.document.addStyle(e)})}},glam.Effect={},glam.Effect.DEFAULT_BLOOM_STRENGTH=1,glam.Effect.DEFAULT_FILM_GRAYSCALE=0,glam.Effect.DEFAULT_FILM_SCANLINECOUNT=512,glam.Effect.DEFAULT_FILM_INTENSITY=.5,glam.Effect.DEFAULT_RGBSHIFT_AMOUNT=.0015,glam.Effect.DEFAULT_DOTSCREEN_SCALE=1,glam.Effect.create=function(e,a){var t=e.getAttribute("type"),r=null;switch(t){case"Bloom":var i=glam.Effect.DEFAULT_BLOOM_STRENGTH,n=e.getAttribute("strength");void 0!=n&&(i=parseFloat(n)),r=new Vizi.Effect(new THREE.BloomPass(i));break;case"FXAA":r=new Vizi.Effect(THREE.FXAAShader);var l=Vizi.Graphics.instance.renderer.domElement.offsetWidth,s=Vizi.Graphics.instance.renderer.domElement.offsetHeight;r.pass.uniforms.resolution.value.set(1/l,1/s);break;case"Film":r=new Vizi.Effect(THREE.FilmShader),r.pass.uniforms.grayscale.value=glam.Effect.DEFAULT_FILM_GRAYSCALE,r.pass.uniforms.sCount.value=glam.Effect.DEFAULT_FILM_SCANLINECOUNT,r.pass.uniforms.nIntensity.value=glam.Effect.DEFAULT_FILM_INTENSITY;break;case"RGBShift":r=new Vizi.Effect(THREE.RGBShiftShader),r.pass.uniforms.amount.value=glam.Effect.DEFAULT_RGBSHIFT_AMOUNT;break;case"DotScreen":r=new Vizi.Effect(THREE.DotScreenShader),r.pass.uniforms.scale.value=glam.Effect.DEFAULT_DOTSCREEN_SCALE;break;case"DotScreenRGB":r=new Vizi.Effect(THREE.DotScreenRGBShader),r.pass.uniforms.scale.value=glam.Effect.DEFAULT_DOTSCREEN_SCALE}return r&&(glam.Effect.parseAttributes(e,r,a),Vizi.Graphics.instance.addEffect(r)),null},glam.Effect.parseAttributes=function(e,a){var t=e.getAttribute("disabled");void 0!=t&&(a.pass.enabled=!1);var r=a.pass.uniforms;for(var i in r){var n=e.getAttribute(i);if(n){var l=null,s=r[i];if(s){switch(s.type){case"t":var o=glam.Material.parseUrl(n);l=THREE.ImageUtils.loadTexture(o),l.wrapS=l.wrapT=THREE.Repeat;break;case"f":l=parseFloat(n);break;case"i":l=parseInt(n)}l&&(s.value=l)}}}},glam.Group={},glam.Group.create=function(){var e=new Vizi.Object;return e},glam.Import={},glam.Import.create=function(e){var a=e.getAttribute("src"),t=new Vizi.Object;if(a){var r=new Vizi.Loader,i=function(e){glam.Import.onLoadComplete(t,e,a),r.removeEventListener("loaded",i)};r.addEventListener("loaded",i),r.loadScene(a)}return t},glam.Import.onLoadComplete=function(e,a){e.addChild(a.scene)},glam.Input={},glam.Input.add=function(e,a){function t(a,t){a.addEventListener(t,function(a){var r=new CustomEvent(t,{detail:{},bubbles:!0,cancelable:!0});for(propName in a)r[propName]=a[propName];e.dispatchEvent(r)})}var r=new Vizi.Picker,i=["click","mouseover","mouseout","mousedown","mouseup","mousemove"];for(index in i){var n=i[index];t(r,n)}a.addComponent(r);var l=new Vizi.ViewPicker;a.addComponent(l),t(l,"viewover"),t(l,"viewout")},glam.Light={},glam.Light.DEFAULT_TYPE="directional",glam.Light.DEFAULT_COLOR="#ffffff",glam.Light.DEFAULT_ANGLE="90deg",glam.Light.DEFAULT_DISTANCE=0,glam.Light.DEFAULT_EXPONENT=Vizi.SpotLight.DEFAULT_EXPONENT,glam.Light.create=function(e,a){function t(e){return glam.Transform.parseRotation(e)}var r=e.getAttribute("type")||glam.Light.DEFAULT_TYPE,i=e.getAttribute("color")||glam.Light.DEFAULT_COLOR,n=e.getAttribute("angle")||glam.Light.DEFAULT_ANGLE,l=e.getAttribute("distance")||glam.Light.DEFAULT_DISTANCE,s=e.getAttribute("exponent")||glam.Light.DEFAULT_EXPONENT,o=new THREE.Vector3(0,0,-1),m=parseFloat(e.getAttribute("dx"))||0,g=parseFloat(e.getAttribute("dy"))||0,c=parseFloat(e.getAttribute("dz"))||0;(m||g||c)&&o.set(m,g,c),o.normalize(),a&&(a.type&&(r=a.type),a.color&&(i=a.color),a.angle&&(n=a.angle),a.distance&&(l=a.distance)),i=(new THREE.Color).setStyle(i).getHex(),n=t(n),l=parseFloat(l),s=parseFloat(s);var u={color:i,angle:n,direction:o,distance:l,exponent:s},p=new Vizi.Object,d=null;switch(r.toLowerCase()){case"directional":d=new Vizi.DirectionalLight(u);break;case"point":d=new Vizi.PointLight(u);break;case"spot":d=new Vizi.SpotLight(u);break;case"ambient":d=new Vizi.AmbientLight(u)}return d?(p.addComponent(d),p):null},glam.Line={},glam.Line.create=function(e,a){var t=glam.Material.create(a,null,"line"),r=new THREE.Geometry;glam.Line.parse(e,r,t);var i=new THREE.Line(r,t),n=new Vizi.Object,l=new Vizi.Visual({object:i});return n.addComponent(l),e.geometry=r,e.material=t,n},glam.Line.parse=function(e,a,t){var r=e.getElementsByTagName("vertices");r&&(r=r[0],glam.Types.parseVector3Array(r,a.vertices));var i=[],n=e.getElementsByTagName("colors");if(n&&(n=n[0])){glam.Types.parseColor3Array(n,i);var l,s=i.length;for(l=0;s>l;l++){var o=i[l];a.colors.push(o.clone())}t.vertexColors=THREE.VertexColors}},glam.Material={},glam.Material.create=function(e,a,t){var r=null;if(e){var i=glam.Material.parseStyle(e);if(e.shader)switch(e.shader.toLowerCase()){case"phong":case"blinn":r=new THREE.MeshPhongMaterial(i);break;case"lambert":r=new THREE.MeshLambertMaterial(i);break;case"line":r=new THREE.LineBasicMaterial(i);break;case"basic":default:r=new THREE.MeshBasicMaterial(i)}else r=e["vertex-shader"]&&e["fragment-shader"]&&e["shader-uniforms"]?glam.Material.createShaderMaterial(e,i,a):"line"==t?void 0!==i.dashSize||void 0!==i.gapSize?new THREE.LineDashedMaterial(i):new THREE.LineBasicMaterial(i):new THREE.MeshBasicMaterial(i)}else r=new THREE.MeshBasicMaterial;return r},glam.Material.parseStyle=function(e){var a="";e.image&&(a=glam.Material.parseUrl(e.image));var t="";e["normal-image"]&&(t=glam.Material.parseUrl(e["normal-image"]));var r="";e["bump-image"]&&(r=glam.Material.parseUrl(e["bump-image"]));var i="";e["specular-image"]&&(i=glam.Material.parseUrl(e["specular-image"]));var n;e.reflectivity&&(n=parseFloat(e.reflectivity));var l;e.refractionRatio&&(l=parseFloat(e.refractionRatio));var s,o,m,g,c=glam.Material.tryParseEnvMap(e),u="";(u=e.color)&&(s=(new THREE.Color).setStyle(u).getHex()),(u=e["diffuse-color"])&&(o=(new THREE.Color).setStyle(u).getHex()),(u=e["specular-color"])&&(m=(new THREE.Color).setStyle(u).getHex()),(u=e["ambient-color"])&&(g=(new THREE.Color).setStyle(u).getHex());var p;e.opacity&&(p=parseFloat(e.opacity));var d=THREE.FrontSide;if(e["backface-visibility"])switch(e["backface-visibility"].toLowerCase()){case"visible":d=THREE.DoubleSide;break;case"hidden":d=THREE.FrontSide}var f;e.hasOwnProperty("render-mode")&&(f="wireframe"==e["render-mode"]);var v;e["line-width"]&&(v=parseInt(e["line-width"]));var E;e["dash-size"]&&(E=parseInt(e["dash-size"]));var h;e["gap-size"]&&(h=parseInt(e["gap-size"]));var T={};return a&&(T.map=THREE.ImageUtils.loadTexture(a)),c&&(T.envMap=c),t&&(T.normalMap=THREE.ImageUtils.loadTexture(t)),r&&(T.bumpMap=THREE.ImageUtils.loadTexture(r)),i&&(T.specularMap=THREE.ImageUtils.loadTexture(i)),void 0!==s&&(T.color=s),void 0!==o&&(T.color=o),void 0!==m&&(T.specular=m),void 0!==g&&(T.ambient=g),void 0!==p&&(T.opacity=p,T.transparent=1>p),void 0!==f&&(T.wireframe=f),void 0!==v&&(T.linewidth=v),void 0!==E&&(T.dashSize=E),void 0!==h&&(T.gapSize=h),void 0!==n&&(T.reflectivity=n),void 0!==l&&(T.refractionRatio=l),T.side=d,T},glam.Material.parseUrl=function(e){var a=/\(([^)]+)\)/,t=a.exec(e);return e=t[1],e=e.replace(/'/g,"")},glam.Material.tryParseEnvMap=function(e){var a=[];if(e["cube-image-right"]&&a.push(glam.Material.parseUrl(e["cube-image-right"])),e["cube-image-left"]&&a.push(glam.Material.parseUrl(e["cube-image-left"])),e["cube-image-top"]&&a.push(glam.Material.parseUrl(e["cube-image-top"])),e["cube-image-bottom"]&&a.push(glam.Material.parseUrl(e["cube-image-bottom"])),e["cube-image-front"]&&a.push(glam.Material.parseUrl(e["cube-image-front"])),e["cube-image-back"]&&a.push(glam.Material.parseUrl(e["cube-image-back"])),6==a.length){var t=THREE.ImageUtils.loadTextureCube(a);return t}return e["sphere-image"]?THREE.ImageUtils.loadTexture(glam.Material.parseUrl(e["sphere-image"]),THREE.SphericalRefractionMapping):null},glam.Material.createShaderMaterial=function(e,a,t){function r(){var e=new THREE.ShaderMaterial({vertexShader:g,fragmentShader:u,uniforms:l});glam.Material.saveShaderMaterial(s,o,e),glam.Material.callShaderMaterialCallbacks(s,o)}var i=e["vertex-shader"],n=e["fragment-shader"],l=glam.Material.parseUniforms(e["shader-uniforms"],a),s=glam.Material.parseUrl(i),o=glam.Material.parseUrl(n);if(!s||!o){var m=document.getElementById(i),g=m.textContent,c=document.getElementById(n),u=c.textContent;return g&&u?new THREE.ShaderMaterial({vertexShader:g,fragmentShader:u,uniforms:l}):null}var p=glam.Material.getShaderMaterial(s,o);if(p)return p;if(glam.Material.addShaderMaterialCallback(s,o,t),!glam.Material.getShaderMaterialLoading(s,o)){glam.Material.setShaderMaterialLoading(s,o);var g="",u="";$.ajax({type:"GET",url:s,dataType:"text",success:function(e){g=e,u&&r()}}),$.ajax({type:"GET",url:o,dataType:"text",success:function(e){u=e,g&&r()}})}},glam.Material.parseUniforms=function(e,a){var t,r={},i=e.split(" "),n=i.length/3;for(t=0;n>t;t++){var l=i[3*t],s=i[3*t+1],o=i[3*t+2];if("f"==s&&(o=parseFloat(o)),"c"==s){var m=new THREE.Color;m.setStyle(o),o=m}else if("t"==s)if(o=o.toLowerCase(),"cube"==o)o=a.envMap;else{var g=glam.Material.parseUrl(o);o=THREE.ImageUtils.loadTexture(g),o.wrapS=o.wrapT=THREE.Repeat}var c={type:s,value:o};r[l]=c}return r},glam.Material.shaderMaterials={},glam.Material.saveShaderMaterial=function(e,a,t){var r=e+a,i=glam.Material.shaderMaterials[r];i.material=t,i.loading=!1},glam.Material.addShaderMaterialCallback=function(e,a,t){var r=e+a,i=glam.Material.shaderMaterials[r];i||(glam.Material.shaderMaterials[r]={material:null,loading:!1,callbacks:[]}),glam.Material.shaderMaterials[r].callbacks.push(t)},glam.Material.callShaderMaterialCallbacks=function(e,a){var t=e+a,r=glam.Material.shaderMaterials[t];if(r&&r.material)for(cb in r.callbacks)r.callbacks[cb](r.material)},glam.Material.getShaderMaterial=function(e,a){var t=e+a,r=glam.Material.shaderMaterials[t];return r?r.material:null},glam.Material.setShaderMaterialLoading=function(e,a){var t=e+a,r=glam.Material.shaderMaterials[t];r&&(r.loading=!0)},glam.Material.getShaderMaterialLoading=function(e,a){var t=e+a,r=glam.Material.shaderMaterials[t];return r&&r.loading},glam.Material.addHandlers=function(e,a,t){e.glam.setAttributeHandlers.push(function(a,r){glam.Material.onSetAttribute(t,e,a,r)}),a.setPropertyHandlers.push(function(a,r){glam.Material.onSetProperty(t,e,a,r)})},glam.Material.onSetAttribute=function(e,a,t,r){var i=e.visuals[0].material;switch(t){case"color":case"diffuse-color":case"diffuseColor":i.color.setStyle(r)}},glam.Material.onSetProperty=function(e,a,t,r){var i=e.visuals[0].material;switch(t){case"color":case"diffuse-color":case"diffuseColor":i.color.setStyle(r)}},glam.Mesh={},glam.Mesh.VERTEX_NORMALS=!1,glam.Mesh.VERTEX_COLORS=!1,glam.Mesh.create=function(e,a){return glam.Visual.create(e,a,glam.Mesh)},glam.Mesh.getAttributes=function(e,a,t){var r=e.getAttribute("vertexNormals");r=null!==r?!0:glam.Mesh.VERTEX_NORMALS;var i=e.getAttribute("vertexColors");i=null!==i?!0:glam.Mesh.VERTEX_COLORS,a&&(a.vertexNormals&&(r=a.vertexNormals),a.vertexColors&&(i=a.vertexColors)),t.vertexNormals=r,t.vertexColors=i},glam.Mesh.createVisual=function(e,a,t){var r=new THREE.Geometry;glam.Mesh.parse(e,r,a,t);var i=new THREE.Mesh(r,a),n=new Vizi.Visual({object:i});return n},glam.Mesh.parse=function(e,a,t,r){var i=e.getElementsByTagName("vertices");i&&(i=i[0],i&&glam.Types.parseVector3Array(i,a.vertices));var n=e.getElementsByTagName("uvs");n&&(n=n[0],n&&glam.Types.parseUVArray(n,a.faceVertexUvs[0]));var l=e.getElementsByTagName("faces");l&&(l=l[0],l&&glam.Types.parseFaceArray(l,a.faces));var s=[],o=e.getElementsByTagName("normals");if(o&&(o=o[0]))if(glam.Types.parseVector3Array(o,s),r.vertexNormals){var m,g=a.faces.length;for(m=0;g>m;m++){var c=a.faces[m];if(c){var u=s[c.a].normalize().clone();c.vertexNormals[0]=u;var u=s[c.b].normalize().clone();c.vertexNormals[1]=u;var u=s[c.c].normalize().clone();c.vertexNormals[2]=u}}}else{var m,g=a.faces.length;for(m=0;g>m;m++){var c=a.faces[m];if(c){var u=s[m].normalize();c.normal.copy(u)}}}var p=[],d=e.getElementsByTagName("colors");if(d&&(d=d[0])){if(glam.Types.parseColor3Array(d,p),r.vertexColors){var m,g=a.faces.length;for(m=0;g>m;m++){var c=a.faces[m];if(c){var f=p[c.a];f&&(c.vertexColors[0]=f.clone());var f=p[c.b];f&&(c.vertexColors[1]=f.clone());var f=p[c.c];f&&(c.vertexColors[2]=f.clone())}}t.vertexColors=THREE.VertexColors}else{var m,g=a.faces.length;for(m=0;g>m;m++){var c=a.faces[m];if(c){var f=p[m];f&&c.color.copy(f)}}t.vertexColors=THREE.FaceColors}a.colorsNeedUpdate=!0,a.buffersNeedUpdate=!0}},glam.Node={},glam.Node.init=function(e){e.glam={},e.glam.setAttributeHandlers=[],e.glam.onSetAttribute=function(a,t){var r,i=e.glam.setAttributeHandlers.length;for(r=0;i>r;r++){var n=e.glam.setAttributeHandlers[r];n&&n(a,t)}}},glam.Node.getStyle=function(e){var a=new glam.ClassList(e);e.glam.classList=a;var t=new glam.Style(e);if(e.id){var r=glam.getStyle("#"+e.id);t.addProperties(r)}var i=e.getAttribute("class");if(i||(i=e["class"]),i){var n=i.split(" ");for(klassname in n){var l=n[klassname];if(l){var r=glam.getStyle("."+l);t.addProperties(r),a.add(l)}}}var r=e.getAttribute("style");return r&&t.addPropertiesFromString(r),e.glam.style=t,t},glam.parser={addDocument:function(e){var a=void 0!==window.WebKitMutationObserver?window.WebKitMutationObserver:window.MutationObserver,t=new a(function(a){a.forEach(function(a){if("childList"==a.type){var t,r=a.addedNodes.length;for(t=0;r>t;t++){var i=a.addedNodes[t],n=glam.viewers[e.id];n.addNode(i)}var t,r=a.removedNodes.length;for(t=0;r>t;t++){var i=a.removedNodes[t],n=glam.viewers[e.id];n.removeNode(i)}}else if("attributes"==a.type){var l=a.target.glam?a.target.glam.onSetAttribute:null;if(l){var s=a.attributeName,o=a.target.getAttribute(s);l(s,o)}}})}),r={attributes:!0,childList:!0,characterData:!0,subtree:!0};t.observe(e,r)},addStyle:function(e){for(selector in e)glam.addStyle(selector,e[selector])},getStyle:function(e){return glam.getStyle(e)},parseDocument:function(e){var a,t,r=(new DOMParser,e.getElementsByTagName("glam")),t=r.length;for(a=0;t>a;a++){var i=r[a];i.id||(i.id="#glamDocument"+glam.documentIndex++),glam.parser.addDocument(i),glam.documents[i.id]=i,i.style.display="none",glam.parser.addEventHandlers(i)}var n=e.getElementsByTagName("style"),t=n.length;for(a=0;t>a;a++)n[a].childNodes.length&&$.parsecss(n[a].childNodes[0].data,function(e){glam.parser.addStyle(e)})},addEventHandlers:function(e){e.addEventListener("mouseover",function(e){e.preventDefault(),e.stopPropagation()}),e.addEventListener("mouseout",function(e){e.preventDefault(),e.stopPropagation()}),e.addEventListener("mousedown",function(e){e.preventDefault(),e.stopPropagation()}),e.addEventListener("mouseup",function(e){e.preventDefault(),e.stopPropagation()}),e.addEventListener("mousemove",function(e){e.preventDefault(),e.stopPropagation()}),e.addEventListener("click",function(e){e.preventDefault(),e.stopPropagation()})}},glam.Particles={},glam.Particles.create=function(e,a){var t=glam.Material.parseStyle(a),r={};glam.Particles.getAttributes(e,a,r),r.map=t.map,r.texture=t.map,r.color=t.color;var i=glam.Particles.parse(e);r.geometry=i.geometry;var n=Vizi.ParticleSystem(r);glam.Particles.addEmitters(i.emitters,n);var l=n.getComponent(Vizi.Visual);e.geometry=l.geometry,e.material=l.material;var s=n.getComponent(Vizi.ParticleSystemScript);return s.active=!0,n},glam.Particles.getAttributes=function(e,a,t){var r=e.getAttribute("maxAge")||glam.Particles.DEFAULT_MAX_AGE,i=parseFloat(e.getAttribute("size"));t.maxAge=parseFloat(r),t.size=i},glam.Particles.parse=function(e){var a={geometry:null,emitters:[]},t=e.getElementsByTagName("emitter");if(t){var r,i=t.length;for(r=0;i>r;r++){var n={},l=t[r];if(l){glam.Particles.parseEmitter(l,n);var s=new Vizi.ParticleEmitter(n);a.emitters.push(s)}}}var o=e.getElementsByTagName("vertices");if(o&&(o=o[0])){var m=new THREE.Geometry;glam.Types.parseVector3Array(o,m.vertices),a.geometry=m}return a},glam.Particles.parseEmitter=function(e,a){var t,r,i=parseFloat(e.getAttribute("size")),n=parseFloat(e.getAttribute("sizeEnd")),l=parseInt(e.getAttribute("particlesPerSecond")),s=parseFloat(e.getAttribute("opacityStart")),o=parseFloat(e.getAttribute("opacityMiddle")),m=parseFloat(e.getAttribute("opacityEnd"));(css=e.getAttribute("colorStart"))&&(t=(new THREE.Color).setStyle(css)),(css=e.getAttribute("colorEnd"))&&(r=(new THREE.Color).setStyle(css));var g=parseFloat(e.getAttribute("vx"))||0,c=parseFloat(e.getAttribute("vy"))||0,u=parseFloat(e.getAttribute("vz"))||0,p=parseFloat(e.getAttribute("ax"))||0,d=parseFloat(e.getAttribute("ay"))||0,f=parseFloat(e.getAttribute("az"))||0,v=parseFloat(e.getAttribute("psx"))||0,E=parseFloat(e.getAttribute("psy"))||0,h=parseFloat(e.getAttribute("psz"))||0,T=parseFloat(e.getAttribute("asx"))||0,A=parseFloat(e.getAttribute("asy"))||0,b=parseFloat(e.getAttribute("asz"))||0,y=new THREE.Vector3(g,c,u),S=new THREE.Vector3(p,d,f),F=new THREE.Vector3(v,E,h),L=new THREE.Vector3(T,A,b),C=e.getAttribute("velocity");C&&glam.Types.parseVector3(C,y);var w=e.getAttribute("acceleration");w&&glam.Types.parseVector3(w,S);var R=e.getAttribute("positionSpread");R&&glam.Types.parseVector3(R,F);var _=e.getAttribute("accelerationSpread");_&&glam.Types.parseVector3(_,L);var D=THREE.NoBlending,U=e.getAttribute("blending")||"";switch(U.toLowerCase()){case"normal":D=THREE.NormalBlending;break;case"additive":D=THREE.AdditiveBlending;break;case"subtractive":D=THREE.SubtractiveBlending;break;case"multiply":D=THREE.MultiplyBlending;break;case"custom":D=THREE.CustomBlending;break;case"none":}a.size=i,a.sizeEnd=n,void 0!==t&&(a.colorStart=t),void 0!==r&&(a.colorEnd=r),a.particlesPerSecond=l,a.opacityStart=s,a.opacityMiddle=o,a.opacityEnd=m,a.velocity=y,a.acceleration=S,a.positionSpread=F,a.accelerationSpread=L,a.blending=D},glam.Particles.addEmitters=function(e,a){var t,r=e.length;for(t=0;r>t;t++)a.addComponent(e[t])},glam.Particles.DEFAULT_MAX_AGE=1,glam.Rect={},glam.Rect.DEFAULT_WIDTH=2,glam.Rect.DEFAULT_HEIGHT=2,glam.Rect.DEFAULT_WIDTH_SEGMENTS=1,glam.Rect.DEFAULT_HEIGHT_SEGMENTS=1,glam.Rect.create=function(e,a){return glam.Visual.create(e,a,glam.Rect)},glam.Rect.getAttributes=function(e,a,t){var r=e.getAttribute("width")||glam.Rect.DEFAULT_WIDTH,i=e.getAttribute("height")||glam.Rect.DEFAULT_HEIGHT,n=e.getAttribute("width")||glam.Rect.DEFAULT_WIDTH_SEGMENTS,l=e.getAttribute("height")||glam.Rect.DEFAULT_HEIGHT_SEGMENTS;a&&(a.width&&(r=a.width),a.height&&(i=a.height),a.widthSegments&&(n=a.widthSegments),a.heightSegments&&(l=a.heightSegments)),r=parseFloat(r),i=parseFloat(i),n=parseInt(n),l=parseInt(l),t.width=r,t.height=i,t.widthSegments=n,t.heightSegments=l},glam.Rect.createVisual=function(e,a,t){var r=new Vizi.Visual({geometry:new THREE.PlaneGeometry(t.width,t.height,t.widthSegments,t.heightSegments),material:a});return r},glam.renderer={},glam.Sphere={},glam.Sphere.DEFAULT_RADIUS=2,glam.Sphere.DEFAULT_WIDTH_SEGMENTS=32,glam.Sphere.DEFAULT_HEIGHT_SEGMENTS=32,glam.Sphere.create=function(e,a){return glam.Visual.create(e,a,glam.Sphere)
},glam.Sphere.getAttributes=function(e,a,t){var r=e.getAttribute("radius")||glam.Sphere.DEFAULT_RADIUS,i=e.getAttribute("width-segments")||glam.Sphere.DEFAULT_WIDTH_SEGMENTS,n=e.getAttribute("height-segments")||glam.Sphere.DEFAULT_HEIGHT_SEGMENTS;a&&(a.radius&&(r=a.radius),(a.widthSegments||a["width-segments"])&&(i=a.widthSegments||a["width-segments"]),(a.heightSegments||a["height-segments"])&&(n=a.heightSegments||a["height-segments"])),r=parseFloat(r),i=parseInt(i),n=parseInt(n),t.radius=r,t.widthSegments=i,t.heightSegments=n},glam.Sphere.createVisual=function(e,a,t){var r=new Vizi.Visual({geometry:new THREE.SphereGeometry(t.radius,t.widthSegments,t.heightSegments),material:a});return r},glam.Style=function(e){this.docelt=e,this._properties={},this.setPropertyHandlers=[],this.defineStandardProperties()},glam.Style.prototype=new Object,glam.Style.prototype.addProperties=function(e){for(p in e)this.addProperty(p,e[p])},glam.Style.prototype.addProperty=function(e,a){this.defineProperty(e,a),this._properties[e]=a},glam.Style.prototype.addPropertiesFromString=function(e){var a,t=e.split(";"),r={},i=t.length;for(a=0;i>a;a++){var n=t[a],l=n.split(":"),s=l[0];if(s=s.replace(/ /g,"")){var o=l[1];r[s]=o}}this.addProperties(r)},glam.Style.prototype.onPropertyChanged=function(e,a){var t,r=this.setPropertyHandlers.length;for(t=0;r>t;t++){var i=this.setPropertyHandlers[t];i&&i(e,a)}},glam.Style.prototype.defineProperty=function(e){Object.defineProperty(this,e,{enumerable:!0,configurable:!0,get:function(){return this._properties[e]},set:function(a){this._properties[e]=a,this.onPropertyChanged(e,a)}})},glam.Style.prototype.defineStandardProperties=function(){var e,a=glam.Style._standardProperties;for(e in a){var t=a[e];this.defineProperty(e,t)}},glam.Style._standardProperties={angle:"","backface-visibility":"visible","background-type":"","bevel-size":"","bevel-thickness":"",color:"","diffuse-color":"",diffuseColor:"","specular-color":"",specularColor:"","dash-size":"",depth:"",distance:"","end-angle":"","cube-image-back":"","cube-image-bottom":"","cube-image-front":"","cube-image-left":"","cube-image-right":"","cube-image-top":"","sphere-image":"",sphereImage:"","font-bevel":"","font-depth":"","font-family":"","font-size":"","font-style":"","font-weight":"","gap-size":"",height:"","line-width":"",image:"","normal-image":"","bump-image":"","specular-image":"",opacity:"",radius:"","radius-segments":"","width-segments":"","height-segments":"",reflectivity:"","refraction-ratio":"","render-mode":"",rx:"",ry:"",rz:"",shader:"phong","fragment-shader":"","vertex-shader":"","shader-uniforms":"","start-angle":"",sx:"",sy:"",sz:"","vertex-colors":"","vertex-normals":"",width:"",x:"",y:"",z:""},glam.Text={},glam.Text.DEFAULT_FONT_SIZE=1,glam.Text.DEFAULT_FONT_DEPTH=.2,glam.Text.DEFAULT_FONT_BEVEL="none",glam.Text.DEFAULT_BEVEL_SIZE=.01,glam.Text.DEFAULT_BEVEL_THICKNESS=.02,glam.Text.DEFAULT_FONT_FAMILY="helvetica",glam.Text.DEFAULT_FONT_WEIGHT="normal",glam.Text.DEFAULT_FONT_STYLE="normal",glam.Text.BEVEL_EPSILON=1e-4,glam.Text.DEFAULT_VALUE="",glam.Text.create=function(e,a){return glam.Visual.create(e,a,glam.Text)},glam.Text.getAttributes=function(e,a,t){var r=e.getAttribute("fontFamily")||glam.Text.DEFAULT_FONT_FAMILY,i=e.getAttribute("fontWeight")||glam.Text.DEFAULT_FONT_WEIGHT,n=e.getAttribute("fontStyle")||glam.Text.DEFAULT_FONT_STYLE,l=e.getAttribute("fontSize")||glam.Text.DEFAULT_FONT_SIZE,s=e.getAttribute("fontDepth")||glam.Text.DEFAULT_FONT_DEPTH,o=e.getAttribute("fontBevel")||glam.Text.DEFAULT_FONT_BEVEL,m=e.getAttribute("bevelSize")||glam.Text.DEFAULT_BEVEL_SIZE,g=e.getAttribute("bevelThickness")||glam.Text.DEFAULT_BEVEL_THICKNESS;switch(a&&(a["font-family"]&&(r=a["font-family"]),a["font-weight"]&&(i=a["font-weight"]),a["font-style"]&&(n=a["font-style"]),a["font-size"]&&(l=a["font-size"]),a["font-depth"]&&(s=a["font-depth"]),a["font-bevel"]&&(o=a["font-bevel"]),a["bevel-size"]&&(m=a["bevel-size"]),a["bevel-thickness"]&&(g=a["bevel-thickness"])),r=r.toLowerCase()){case"optima":r="optimer";break;case"helvetica":default:r="helvetiker"}var c=THREE.FontUtils.faces[r];c||(r="helvetiker"),i=i.toLowerCase(),"bold"!=i&&(i="normal"),n=n.toLowerCase(),n="normal",l=parseFloat(l),s=parseFloat(s),m=parseFloat(m),g=parseFloat(g),bevelEnabled="bevel"==o.toLowerCase()?!0:!1,s||(bevelEnabled=!1),bevelEnabled||(g=m=glam.Text.BEVEL_EPSILON,bevelEnabled=!0);var u=e.getAttribute("value")||glam.Text.DEFAULT_VALUE;u||(u=e.textContent),t.value=u,t.fontSize=l,t.fontDepth=s,t.bevelSize=m,t.bevelThickness=g,t.bevelEnabled=bevelEnabled,t.fontFamily=r,t.fontWeight=i,t.fontStyle=n},glam.Text.createVisual=function(e,a,t){if(!t.value)return null;var r=4,i=new THREE.TextGeometry(t.value,{font:t.fontFamily,weight:t.fontWeight,style:t.fontStyle,size:t.fontSize,height:t.fontDepth,curveSegments:r,bevelThickness:t.bevelThickness,bevelSize:t.bevelSize,bevelEnabled:t.bevelEnabled,material:0,extrudeMaterial:1});i.computeBoundingBox(),i.computeVertexNormals();var n=a.clone();n.shading=THREE.FlatShading;var l=a.clone();l.shading=THREE.SmoothShading;var s=new THREE.MeshFaceMaterial([n,l]),o=new Vizi.Visual({geometry:i,material:s});return i.center(),o},glam.Transform={},glam.Transform.parse=function(e,a,t){var r={};r.x=parseFloat(e.getAttribute("x"))||0,r.y=parseFloat(e.getAttribute("y"))||0,r.z=parseFloat(e.getAttribute("z"))||0,r.rx=glam.Transform.parseRotation(e.getAttribute("rx"))||0,r.ry=glam.Transform.parseRotation(e.getAttribute("ry"))||0,r.rz=glam.Transform.parseRotation(e.getAttribute("rz"))||0,r.sx=parseFloat(e.getAttribute("sx"))||1,r.sy=parseFloat(e.getAttribute("sy"))||1,r.sz=parseFloat(e.getAttribute("sz"))||1;var i=e.getAttribute("transform");i&&glam.Transform.parseTransform(i,r),a&&glam.Transform.parseStyle(a,r),t.transform.position.set(r.x,r.y,r.z),t.transform.rotation.set(r.rx,r.ry,r.rz),t.transform.scale.set(r.sx,r.sy,r.sz),e.glam.setAttributeHandlers.push(function(a,r){glam.Transform.onSetAttribute(t,e,a,r)}),a.setPropertyHandlers.push(function(a,r){glam.Transform.onSetAttribute(t,e,a,r)})},glam.Transform.parseStyle=function(e,a){e&&(e.x&&(a.x=parseFloat(e.x)),e.y&&(a.y=parseFloat(e.y)),e.z&&(a.z=parseFloat(e.z)),e.rx&&(a.rx=glam.Transform.parseRotation(e.rx)),e.ry&&(a.ry=glam.Transform.parseRotation(e.ry)),e.rz&&(a.rz=glam.Transform.parseRotation(e.rz)),e.sx&&(a.sx=parseFloat(e.sx)),e.sy&&(a.sy=parseFloat(e.sy)),e.sz&&(a.sz=parseFloat(e.sz)),e.transform&&glam.Transform.parseTransform(e.transform,a))},glam.Transform.parseRotation=function(e){if(!e)return null;e=e.toLowerCase();var a=e.indexOf("deg");if(-1!=a){var t=e.split("deg");if(t.length){var r=parseFloat(t[0]);return THREE.Math.degToRad(r)}}var a=e.indexOf("rad");if(-1!=a){var i=e.split("rad");if(i.length){var n=parseFloat(i[0]);return n}}return parseFloat(e)},glam.Transform.parseTransform=function(e,a){var t,r=e.split(" "),i=r.length;for(t=0;i>t;t++){var n=r[t],l=n.split("(")[0],s=/\(([^)]+)\)/,o=s.exec(n),m=o[1];switch(l){case"translateX":a.x=parseFloat(m);break;case"translateY":a.y=parseFloat(m);break;case"translateZ":a.z=parseFloat(m);break;case"rotateX":a.rx=glam.Transform.parseRotation(m);break;case"rotateY":a.ry=glam.Transform.parseRotation(m);break;case"rotateZ":a.rz=glam.Transform.parseRotation(m);break;case"scaleX":a.sx=parseFloat(m);break;case"scaleY":a.sy=parseFloat(m);break;case"scaleZ":a.sz=parseFloat(m)}}},glam.Transform.onSetAttribute=function(e,a,t,r){var i=parseFloat(r);switch(t){case"x":e.transform.position.x=i;break;case"y":e.transform.position.y=i;break;case"z":e.transform.position.z=i;break;case"rx":e.transform.rotation.x=i;break;case"ry":e.transform.rotation.y=i;break;case"rz":e.transform.rotation.z=i;break;case"sx":e.transform.scale.x=i;break;case"sy":e.transform.scale.y=i;break;case"sz":e.transform.scale.z=i}},glam.Transition={},glam.Transition.DEFAULT_DURATION=glam.Animation.DEFAULT_DURATION,glam.Transition.DEFAULT_TIMING_FUNCTION=glam.Animation.DEFAULT_TIMING_FUNCTION,glam.Transition.parse=function(e,a){var t,r=a.transition||"",i={},n=r.split(","),l=n.length;for(t=0;l>t;t++){var s=n[t];if(s){var o=s.split(" ");""==o[0]&&o.shift();var m=o[0],g=o[1],c=o[2]||glam.Transition.DEFAULT_TIMING_FUNCTION,u=o[3]||"";g=glam.Animation.parseTime(g),c=glam.Animation.parseTimingFunction(c),u=glam.Animation.parseTime(u),i[m]={duration:g,timingFunction:c,delay:u}}}},glam.Types={},glam.Types.types={cube:{cls:glam.Cube,transform:!0,animation:!0,input:!0,visual:!0},cone:{cls:glam.Cone,transform:!0,animation:!0,input:!0,visual:!0},cylinder:{cls:glam.Cylinder,transform:!0,animation:!0,input:!0,visual:!0},sphere:{cls:glam.Sphere,transform:!0,animation:!0,input:!0,visual:!0},rect:{cls:glam.Rect,transform:!0,animation:!0,input:!0,visual:!0},circle:{cls:glam.Circle,transform:!0,animation:!0,input:!0,visual:!0},arc:{cls:glam.Arc,transform:!0,animation:!0,input:!0,visual:!0},group:{cls:glam.Group,transform:!0,animation:!0,input:!0},animation:{cls:glam.Animation},background:{cls:glam.Background},"import":{cls:glam.Import,transform:!0,animation:!0},camera:{cls:glam.Camera,transform:!0,animation:!0},controller:{cls:glam.Controller},text:{cls:glam.Text,transform:!0,animation:!0,input:!0,visual:!0},mesh:{cls:glam.Mesh,transform:!0,animation:!0,input:!0,visual:!0},line:{cls:glam.Line,transform:!0,animation:!0,visual:!0},light:{cls:glam.Light,transform:!0,animation:!0},particles:{cls:glam.Particles,transform:!0,animation:!0},effect:{cls:glam.Effect}},glam.Types.parseVector3Array=function(e,a){var t,r=e.textContent,i=r.split(" "),n=i.length;if(!(3>n))for(t=0;n>t;t+=3){var l=parseFloat(i[t]),s=parseFloat(i[t+1]),o=parseFloat(i[t+2]),m=new THREE.Vector3(l,s,o);a.push(m)}},glam.Types.parseVector3=function(e,a){var t=e.split(" "),r=t.length;if(!(3>r)){var i=parseFloat(t[0]),n=parseFloat(t[1]),l=parseFloat(t[2]);a.set(i,n,l)}},glam.Types.parseVector2Array=function(e,a){var t,r=e.textContent,i=r.split(" "),n=i.length;if(!(2>n))for(t=0;n>t;t+=2){var l=parseFloat(i[t]),s=parseFloat(i[t+1]),o=new THREE.Vector2(l,s);a.push(o)}},glam.Types.parseColor3Array=function(e,a){var t,r=e.textContent,i=r.split(" "),n=i.length;if(!(3>n))for(t=0;n>t;t+=3){var l=parseFloat(i[t]),s=parseFloat(i[t+1]),o=parseFloat(i[t+2]),m=new THREE.Color(l,s,o);a.push(m)}},glam.Types.parseColor3=function(e,a){var t=e.split(" "),r=t.length;if(!(3>r)){var i=parseFloat(t[0]),n=parseFloat(t[1]),l=parseFloat(t[2]);a.setRGB(i,n,l)}},glam.Types.parseFaceArray=function(e,a){var t,r=e.textContent,i=r.split(" "),n=i.length;if(!(1>n))for(t=0;n>t;t+=3){var l=parseInt(i[t]),s=parseInt(i[t+1]),o=parseInt(i[t+2]),m=new THREE.Face3(l,s,o);a.push(m)}},glam.Types.parseUVArray=function(e,a){var t,r=e.textContent,i=r.split(" "),n=i.length;if(!(6>n))for(t=0;n>t;t+=6){for(var l=[],s=0;3>s;s++){var o=parseFloat(i[t+2*s]),m=parseFloat(i[t+2*s+1]),g=new THREE.Vector2(o,m);l.push(g)}a.push(l)}},glam.Viewer=function(e){this.document=e,this.documentParent=e.parentElement,this.riftRender=glam.riftRender||!1,this.cardboardRender=glam.cardboardRender||!1,this.displayStats=glam.displayStats||!1},glam.Viewer.prototype=new Object,glam.Viewer.prototype.initRenderer=function(){var e=this.document.getElementsByTagName("renderer");if(e){var a=e[0];if(a){var t=a.getAttribute("type").toLowerCase();"rift"==t?this.riftRender=!0:"cardboard"==t&&(this.cardboardRender=!0)}}this.app=new Vizi.Viewer({container:this.documentParent,headlight:!1,riftRender:this.riftRender,cardboard:this.cardboardRender,displayStats:this.displayStats})},glam.Viewer.prototype.initDefaultScene=function(){this.scene=new Vizi.Object,this.app.sceneRoot.addChild(this.scene),this.app.defaultCamera.position.set(0,0,5)},glam.Viewer.prototype.traverseScene=function(){var e=this.document.getElementsByTagName("scene");if(!e)return void console.warn("Document error! glam requires one 'scene' element");var a=e[0];this.traverse(a,this.scene)},glam.Viewer.prototype.traverse=function(e,a){var t,r,i=e.tagName,n=e.childNodes,r=n.length;for(t=0;r>t;t++){var l=n[t],i=l.tagName;i&&(i=i.toLowerCase());var s=null,o=i?glam.Types.types[i]:null;if(o&&o.cls&&(s=o.cls.create)&&"function"==typeof s){glam.Node.init(l);var m=glam.Node.getStyle(l),g=s.call(this,l,m,this.app);g&&(l.glam.object=g,this.addFeatures(l,m,g,o),a.addChild(g),this.traverse(l,g))}}},glam.Viewer.prototype.addNode=function(e){var a=e.tagName;a&&(a=a.toLowerCase());var t=null,r=a?glam.Types.types[a]:null;if(r&&r.cls&&(t=r.cls.create)&&"function"==typeof t){glam.Node.init(e);var i=glam.Node.getStyle(e),n=t.call(this,e,i,this.app);n&&(e.glam.object=n,this.addFeatures(e,i,n,r),this.scene.addChild(n),this.traverse(e,n))}},glam.Viewer.prototype.removeNode=function(e){var a=e.glam.object;a&&a._parent.removeChild(a)},glam.Viewer.prototype.addFeatures=function(e,a,t,r){r.transform&&glam.Transform.parse(e,a,t),r.animation&&(glam.Animation.parse(e,a,t),glam.Transition.parse(e,a,t)),r.input&&glam.Input.add(e,t),r.visual&&(glam.Visual.addProperties(e,t),glam.Material.addHandlers(e,a,t))},glam.Viewer.prototype.go=function(){this.initRenderer(),this.initDefaultScene(),this.traverseScene(),this.prepareViewsAndControllers(),this.app.run()},glam.Viewer.prototype.prepareViewsAndControllers=function(){var e=this.app.cameras;if(e&&e.length){var a=e[0],t=Vizi.Application.instance.controllerScript;t.camera=a,t.enabled=!0,a.active=!0}},glam.Visual={},glam.Visual.create=function(e,a,t){var r={};t.getAttributes(e,a,r);var i=new Vizi.Object,n=glam.Material.create(a,function(a){glam.Visual.createVisual(i,t,e,a,r)});return n&&glam.Visual.createVisual(i,t,e,n,r),i},glam.Visual.createVisual=function(e,a,t,r,i){var n=a.createVisual(t,r,i);n&&(e.addComponent(n),glam.Visual.addProperties(t,e))},glam.Visual.addProperties=function(e,a){var t=a.getComponents(Vizi.Visual),r=t[0];r&&(e.geometry=r.geometry,e.material=r.material)};
//# sourceMappingURL=glamlib.min.js.map